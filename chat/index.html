<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayan AI Chat</title>
    <link rel="stylesheet" href="../styles-light.css" id="theme-stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10 9V7a2 2 0 0 1 4 0v2"/>
                        <path d="M12 12h.01"/>
                        <path d="M12 17h.01"/>
                        <rect width="18" height="18" x="3" y="3" rx="2"/>
                    </svg>
                </div>
                <div class="sidebar-info">
                    <h3>Bayan AI</h3>
                    <p>Assistant</p>
                </div>
                <button id="logoutBtn" href="/" style="background-color: transparent; border: none; cursor: pointer;" class="theme-toggle-button" aria-label="Toggle theme">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <button style="background-color: transparent; border: none; cursor: pointer;" class="theme-toggle-button" id="themeToggleButton" aria-label="Toggle theme">
                    <!-- Sun icon for light mode -->
                    <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun">
                        <circle cx="12" cy="12" r="4"/>
                        <path d="M12 2v2"/>
                        <path d="M12 20v2"/>
                        <path d="M4.93 4.93l1.41 1.41"/>
                        <path d="M17.66 17.66l1.41 1.41"/>
                        <path d="M2 12h2"/>
                        <path d="M20 12h2"/>
                        <path d="M6.34 17.66l-1.41 1.41"/>
                        <path d="M19.07 4.93l-1.41 1.41"/>
                    </svg>
                    <!-- Moon icon for dark mode -->
                    <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" style="display: none;">
                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                    </svg>
                </button>
                <button class="sidebar-toggle-button" id="sidebarToggle" aria-label="Toggle sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
            </div>
            <nav class="sidebar-nav">
                <div class="sidebar-group">
                    <!-- <button style="background-color: transparent; border: none; cursor: pointer;" class="theme-toggle-button" id="themeToggleButton" aria-label="Toggle theme">
                        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun">
                            <circle cx="12" cy="12" r="4"/>
                            <path d="M12 2v2"/>
                            <path d="M12 20v2"/>
                            <path d="M4.93 4.93l1.41 1.41"/>
                            <path d="M17.66 17.66l1.41 1.41"/>
                            <path d="M2 12h2"/>
                            <path d="M20 12h2"/>
                            <path d="M6.34 17.66l-1.41 1.41"/>
                            <path d="M19.07 4.93l-1.41 1.41"/>
                        </svg>
                        <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" style="display: none;">
                            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                        </svg>
                    </button> -->
                    <div class="sidebar-group-label">Chats</div>
                    <ul class="sidebar-menu" style="padding-right: 15px;">
                        <li class="sidebar-menu-item active">
                            <button data-chatId="" class="sidebar-menu-button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 5v14"/>
                                    <path d="M5 12h14"/>
                                </svg>
                                <span>New Chat</span>
                            </button>
                        </li>
                        <!-- <li>
                            <button class="sidebar-menu-button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V3a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                </svg>
                                <span>Latest AI Trends</span>
                            </button>
                        </li>
                        <li>
                            <button class="sidebar-menu-button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V3a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                </svg>
                                <span>Productivity Tips</span>
                            </button>
                        </li> -->
                    </ul>
                </div>
                <div class="sidebar-separator"></div>
                <div class="sidebar-group">
                    <div class="sidebar-group-label">Tools</div>
                    <ul class="sidebar-menu">
                        <li>
                            <button class="sidebar-menu-button" id="openUploadModalButton">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="12" y1="17" x2="12" y2="11"/>
                                    <line x1="9" y1="14" x2="15" y2="14"/>
                                </svg>
                                <span>Upload Documents</span>
                            </button>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Chat Area -->
        <main class="main-chat-area">
            <div class="chat-header">
                <button class="sidebar-toggle-button-mobile" id="sidebarToggleMobile" aria-label="Toggle sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
                <div class="header-content">
                    <div class="header-avatar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 9V7a2 2 0 0 1 4 0v2"/>
                            <path d="M12 12h.01"/>
                            <path d="M12 17h.01"/>
                            <rect width="18" height="18" x="3" y="3" rx="2"/>
                        </svg>
                    </div>
                    <div class="header-info">
                        <h3>Bayan AI Assistant</h3>
                        <p>Online</p>
                    </div>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages" role="log" aria-live="polite">
                <!-- <div class="message bot-message">
                    <div class="message-avatar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 9V7a2 2 0 0 1 4 0v2"/>
                            <path d="M12 12h.01"/>
                            <path d="M12 17h.01"/>
                            <rect width="18" height="18" x="3" y="3" rx="2"/>
                        </svg>
                    </div>
                    <div class="message-content">
                        <h4>Hello! How can I assist you today?</h4>
                        <p>I'm Bayan AI, your intelligent companion. Feel free to ask me anything!</p>
                    </div>
                </div>
                <div class="message user-message">
                    <div class="message-content">
                        <p>Tell me about the latest AI trends.</p>
                    </div>
                    <div class="message-avatar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                </div>
                <div class="message bot-message">
                    <div class="message-avatar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 9V7a2 2 0 0 1 4 0v2"/>
                            <path d="M12 12h.01"/>
                            <path d="M12 17h.01"/>
                            <rect width="18" height="18" x="3" y="3" rx="2"/>
                        </svg>
                    </div>
                    <div class="message-content">
                        <h4>Some key AI trends include:</h4>
                        <p>• Generative AI (e.g., large language models like GPT-4o)<br>• AI in healthcare for diagnostics and drug discovery<br>• Edge AI for real-time processing<br>• Explainable AI (XAI) for transparency</p>
                    </div>
                </div> -->
            </div>
            <div class="chat-input">
                <input type="text" placeholder="Type your message..." id="chatInput" aria-label="Type your message">
                <button id="sendMessageButton" aria-label="Send message">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m22 2-7 20-4-9-9-4Z"/>
                        <path d="M22 2 11 13"/>
                    </svg>
                </button>
            </div>
        </main>
    </div>

    <div id="uploadModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Upload Documents</h2>
                <button class="modal-close-button" id="closeUploadModalButton" aria-label="Close upload modal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
    
            <div class="modal-body">
                <!-- Upload Form (Initial State) -->
                <div id="uploadForm">
                    <div class="upload-area">
                        <p>Drag & drop your files here, or click to browse.</p>
                        <input type="file" id="fileInput" multiple accept=".pdf,.txt,.png,.jpg,.jpeg" style="display: none;">
                        <button class="upload-button" id="browseFilesButton">Browse Files</button>
                        <div id="fileList" class="file-list"></div>
                    </div>
                    <p class="modal-info">Supported formats: PDF, TXT, PNG, JPG, JPEG.</p>
                </div>
    
                <!-- Upload Success (Hidden Initially) -->
                <div id="uploadSuccess" class="upload-success hidden">
                    <div class="success-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20,6 9,17 4,12"/>
                        </svg>
                    </div>
                    <h3 class="success-title">Upload Successful!</h3>
                    <p class="success-message">Your files have been uploaded and are being processed. You'll be notified once they're ready for use.</p>
                    
                    <div class="uploaded-files-list">
                        <div class="uploaded-files-title">Uploaded Files</div>
                        <div id="uploadedFilesList"></div>
                    </div>
    
                    <div class="success-actions">
                        <button class="success-button secondary" id="uploadMoreButton">Upload More</button>
                        <button class="success-button primary" id="continueButton">Continue</button>
                    </div>
                </div>
            </div>
    
            <div class="modal-footer" id="modalFooter">
                <button disabled class="modal-action-button" id="startUploadButton">Start Upload</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            async function redirectIfNotLoggedIn() {
                try {
                    const response = await fetch("http://localhost/BayanAI/api/users/me.php", {
                        credentials: "include",
                    });

                    if (!response.ok) {
                        throw new Error("Not authenticated");
                    }

                    const user = await response.json();
                    if (!user || !user.data.id) {
                        window.location.href = "/BayanAI/auth/login";
                    }
                } catch (error) {
                    window.location.href = "/BayanAI/auth/login";
                }
            }
            redirectIfNotLoggedIn();
        });
    </script>

    <script src="./chat.js"></script>

    <script>
        
    document.addEventListener("DOMContentLoaded", () => {
    const chatInput = document.getElementById("chatInput");
    const sendMessageButton = document.getElementById("sendMessageButton");
    const chatMessages = document.getElementById("chatMessages");
    const sidebar = document.getElementById("sidebar");
    const sidebarOverlay = document.getElementById("sidebarOverlay"); // Add this if you have an overlay
    const sidebarToggle = document.getElementById("sidebarToggle"); // Desktop sidebar toggle
    const sidebarToggleMobile = document.getElementById("sidebarToggleMobile"); // Mobile sidebar toggle
    const uploadModal = document.getElementById("uploadModal");
    const openUploadModalButton = document.getElementById("openUploadModalButton");
    const closeUploadModalButton = document.getElementById("closeUploadModalButton");
    const browseFilesButton = document.getElementById("browseFilesButton");
    const fileInput = document.getElementById("fileInput");
    const fileList = document.getElementById("fileList");
    const startUploadButton = document.getElementById("startUploadButton");
    const themeStylesheet = document.getElementById("theme-stylesheet");
    const themeToggleButton = document.getElementById("themeToggleButton");
    const sunIcon = document.getElementById("sun-icon");
    const moonIcon = document.getElementById("moon-icon");
    const continueButton = document.getElementById("continueButton");
    const uploadMoreButton = document.getElementById("uploadMoreButton");

    // Function to scroll chat messages to the bottom
    function scrollToBottom() {
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Function to add a message to the chat
    function addMessage(content, role, isBotResponse = false) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${role}-message`;
        
        let avatarSvg = "";
        if (role === "bot") {
            avatarSvg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10 9V7a2 2 0 0 1 4 0v2"/>
                    <path d="M12 12h.01"/>
                    <path d="M12 17h.01"/>
                    <rect width="18" height="18" x="3" y="3" rx="2"/>
                </svg>
            `;
        } else {
            // user
            avatarSvg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
            `;
        }

        const messageContentHtml = isBotResponse ? `<h4>${content.title}</h4><p>${content.text}</p>` : `<p>${content}</p>`;

        messageDiv.innerHTML = `
            <div class="message-avatar">${avatarSvg}</div>
            <div class="message-content">${messageContentHtml}</div>
        `;

        // For user messages, reverse the order of avatar and content
        if (role === "user") {
            messageDiv.style.flexDirection = "row-reverse";
        }

        chatMessages.appendChild(messageDiv);
        scrollToBottom();
    }


    // Function to close sidebar
    function closeSidebar() {
        sidebar.classList.remove("visible");
        if (sidebarOverlay) {
            sidebarOverlay.classList.remove("visible");
        }
        document.body.style.overflow = "";
    }

    // Function to toggle sidebar
    function toggleSidebar() {
        const isMobile = window.innerWidth <= 768;
        
        if (isMobile) {
            if (sidebar.classList.contains("visible")) {
                closeSidebar();
            } else {
                sidebar.classList.add("visible");
                if (sidebarOverlay) {
                    sidebarOverlay.classList.add("visible");
                }
                document.body.style.overflow = "hidden";
            }
        } else {
            sidebar.classList.toggle("hidden");
        }
    }

    // Sidebar toggle functionality for desktop
    if (sidebarToggle) {
        sidebarToggle.addEventListener("click", (event) => {
            event.stopPropagation(); // Prevent the document click event
            toggleSidebar();
        });
    }

    // Sidebar toggle functionality for mobile (hamburger icon)
    if (sidebarToggleMobile) {
        sidebarToggleMobile.addEventListener("click", (event) => {
            event.stopPropagation(); // Prevent the document click event
            toggleSidebar();
        });
    }

    // Close sidebar when clicking overlay
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener("click", closeSidebar);
    }

    // Close sidebar when clicking outside on mobile - FIXED VERSION
    document.addEventListener("click", (event) => {
        // Only proceed if sidebar is visible (mobile state)
        if (!sidebar.classList.contains("visible")) return;

        const isClickInsideSidebar = sidebar.contains(event.target);
        const isClickOnMobileToggle = sidebarToggleMobile && sidebarToggleMobile.contains(event.target);
        const isClickOnSidebarToggle = sidebarToggle && sidebarToggle.contains(event.target); // ADD THIS LINE
        
        // Check if sidebar is visible and click is outside sidebar and not on ANY toggle button
        if (sidebar.classList.contains("visible") && 
            !isClickInsideSidebar && 
            !isClickOnMobileToggle && 
            !isClickOnSidebarToggle) { // ADD THIS CONDITION
            closeSidebar();
        }
    });

    // Handle sidebar visibility on window resize
    function handleResize() {
        if (window.innerWidth > 768) { // Assuming 768px is the breakpoint for mobile/desktop
            sidebar.classList.remove("hidden"); // Ensure sidebar is visible on desktop
            sidebar.classList.remove("visible"); // Remove mobile-specific visible class
            if (sidebarOverlay) {
                sidebarOverlay.classList.remove("visible");
            }
            document.body.style.overflow = "";
        } else {
            // On mobile, if it's not explicitly visible, keep it hidden
            if (!sidebar.classList.contains("visible")) {
                sidebar.classList.add("hidden");
            }
        }
    }

    window.addEventListener("resize", handleResize);
    handleResize(); // Call on initial load to set correct state

    // Prevent sidebar from closing when clicking inside it
    sidebar.addEventListener("click", (event) => {
        event.stopPropagation();
    });

    // Add escape key support
    document.addEventListener("keydown", (event) => {
        if (event.key === "Escape" && sidebar.classList.contains("visible")) {
            closeSidebar();
        }
    });

    // Modal functionality
    openUploadModalButton.addEventListener("click", () => {
        uploadModal.classList.add("visible");
        document.body.classList.add("modal-open"); // Prevent body scroll
    });

    closeUploadModalButton.addEventListener("click", () => {
        uploadModal.classList.remove("visible");
        document.body.classList.remove("modal-open");
        fileList.innerHTML = ""; // Clear file list on close
        fileInput.value = ""; // Clear file input
        startUploadButton.disabled = true; // Disable upload button
    });

    uploadModal.addEventListener("click", (event) => {
        if (event.target === uploadModal) {
            uploadModal.classList.remove("visible");
            document.body.classList.remove("modal-open");
            fileList.innerHTML = ""; // Clear file list on close
            fileInput.value = ""; // Clear file input
            startUploadButton.disabled = true; // Disable upload button
        }
    });

    browseFilesButton.addEventListener("click", () => {
        fileInput.click();
    });

    fileInput.addEventListener("change", (event) => {
        fileList.innerHTML = ""; // Clear previous list
        const files = event.target.files;
        if (files.length > 0) {
            for (let i = 0; i < files.length; i++) {
                const fileItem = document.createElement("div");
                fileItem.className = "file-item";
                fileItem.textContent = files[i].name;
                fileList.appendChild(fileItem);
            }
            startUploadButton.disabled = false;
        } else {
            startUploadButton.disabled = true;
        }
    });

    startUploadButton.addEventListener("click", (e) => {
        startUpload(e);
    });

    uploadMoreButton.addEventListener("click", () => {
        uploadMore();
    });

    continueButton.addEventListener("click", () => {
        closeModal();
    });

    // Theme toggle functionality
    function applyTheme(theme) {
        themeStylesheet.href = `../styles-${theme}.css`;
        localStorage.setItem("theme", theme);
        if (theme === "dark") {
            sunIcon.style.display = "none";
            moonIcon.style.display = "block";
        } else {
            sunIcon.style.display = "block";
            moonIcon.style.display = "none";
        }
    }

    themeToggleButton.addEventListener("click", () => {
        const currentTheme = localStorage.getItem("theme") || "light";
        const newTheme = currentTheme === "light" ? "dark" : "light";
        applyTheme(newTheme);
    });

    // Apply saved theme on load
    const savedTheme = localStorage.getItem("theme") || "light"; // Default to light if no preference
    applyTheme(savedTheme);

    // Initial scroll to bottom in case of pre-filled messages
    scrollToBottom();

    const logoutBtn = document.getElementById("logoutBtn");
    logoutBtn.addEventListener("click", async () => {
        const res = await fetch("http://localhost/bayanai/api/users/logout.php", {
            method: "POST",
            credentials: "include",
        });
        if (res.ok) {
            window.location.href = "/bayanai/auth/login"
            // redirectIfNotLoggedIn();
        }
    });

    let selectedFiles = [];

    function toggleTheme() {
        const body = document.body;
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    }

    function openModal() {
        document.getElementById('uploadModal').classList.add('visible');
        document.body.style.overflow = 'hidden';
    }

    function closeModal() {
        document.getElementById('uploadModal').classList.remove('visible');
        document.body.style.overflow = '';
        startUploadButton.style.display = "block";
        resetModal();
    }

    function resetModal() {
        // Reset to initial state
        document.getElementById('modalTitle').textContent = 'Upload Documents';
        document.getElementById('uploadForm').classList.remove('hidden');
        document.getElementById('uploadSuccess').classList.add('hidden');
        document.getElementById('modalFooter').classList.remove('hidden');
        document.getElementById('fileList').innerHTML = '';
        document.getElementById('fileInput').value = '';
        document.getElementById('startUploadButton').disabled = true;
        selectedFiles = [];
    }

    function uploadMore() {
        resetModal();
    }

    // File input handling
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const files = Array.from(e.target.files);
        selectedFiles = files;
        displayFileList(files);
        document.getElementById('startUploadButton').disabled = files.length === 0;
    });

    function displayFileList(files) {
        const fileList = document.getElementById('fileList');
        fileList.innerHTML = '';
        
        files.forEach(file => {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.textContent = file.name;
            fileList.appendChild(fileItem);
        });
    }

    async function startUpload(e) {
            // Show upload success state
        document.getElementById('modalTitle').textContent = 'Upload Complete';
        document.getElementById('uploadForm').classList.add('hidden');
        document.getElementById('uploadSuccess').classList.remove('hidden');
        document.getElementById('modalFooter').classList.add('hidden');
        async function uploadFilesToGemini(files) {
            const formData = new FormData();
            
            for (let i = 0; i < files.length; i++) {
                formData.append('files[]', files[i]);
            }
            
            try {
                const response = await fetch('http://localhost/BayanAI/api/documentChunks/upload.php', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    console.log('Text extraction successful:', result.data);
                    return result.data;
                } else {
                    console.error('Error:', result.data);
                    throw new Error(result.data);
                }
            } catch (error) {
                console.error('Upload failed:', error);
                throw error;
            }
        }

        console.log(await uploadFilesToGemini(selectedFiles));
        displayUploadedFiles(selectedFiles);
    }

    function displayUploadedFiles(files) {
        const uploadedFilesList = document.getElementById('uploadedFilesList');
        uploadedFilesList.innerHTML = '';
        startUploadButton.style.display = "none";

        files.forEach(file => {
            const fileItem = document.createElement('div');
            fileItem.className = 'uploaded-file-item';
            
            fileItem.innerHTML = `
                <svg class="file-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                    <polyline points="14 2 14 8 20 8"/>
                </svg>
                <span class="file-name">${file.name}</span>
                <span class="file-status">✓ Uploaded</span>
            `;
            
            uploadedFilesList.appendChild(fileItem);
        });
    }

    document.getElementById('uploadModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeModal();
        }
    });

}); 
    </script>
</body>
</html>